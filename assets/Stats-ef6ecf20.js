class m{constructor(t,i,e,s,h){this.name=t,this.foreground=i,this.background=e,this.msRefresh=s,this.refreshCallback=h,this.data=[],this._min=1/0,this._max=0,this.lastTime=0,this.pixelRatio=Math.round(devicePixelRatio||1),this.width=100*this.pixelRatio,this.height=60*this.pixelRatio,this.text={position:{x:3*this.pixelRatio,y:2*this.pixelRatio}},this.graph={position:{x:3*this.pixelRatio,y:18*this.pixelRatio},size:{width:94*this.pixelRatio,height:40*this.pixelRatio}},this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100px",this.canvas.style.height="60px",this.canvas.style.borderRadius="5px",this.context=this.canvas.getContext("2d"),this.init(),this.dom=this.canvas}get min(){return this._min}get max(){return this._max}init(){if(!this.context)return;const t=12*this.pixelRatio;this.context.font=`400 ${t}px "Avenir Next", Helvetica, "Helvetica Neue", Arial, sans-serif`,this.context.textBaseline="top",this.context.fillStyle=this.background,this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle=this.foreground,this.context.fillText(this.name,this.text.position.x,this.text.position.y)}update(t){const i=t-this.lastTime;if(i<this.msRefresh)return;const e=this.refreshCallback(t,i);if(!e)return;this.lastTime=t;const{value:s,maxValue:h}=e;this._min=Math.min(this._min,s),this._max=Math.max(this._max,s),this.data.push(s);const n=Math.max(this._max,h);if(this.data.length>this.graph.size.width&&this.data.splice(0,this.data.length-this.graph.size.width),!!this.context){this.context.fillStyle=this.background,this.context.globalAlpha=1,this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle=this.foreground,this.context.fillText(`${Math.round(s)} ${this.name} (${Math.round(this._min)}-${Math.round(this._max)})`,this.text.position.x,this.text.position.y),this.context.beginPath(),this.context.moveTo(this.data.length+this.graph.position.x,(1-this.data[this.data.length-1]/n)*this.graph.size.height+this.graph.position.y);for(let a=this.data.length-1;a>0;a--){const o=a-.5+this.graph.position.x,r=p=>(1-p/n)*this.graph.size.height+this.graph.position.y,c=r(this.data[a]),d=r(this.data[a-1]);this.context.bezierCurveTo(o,c,o,d,a-1+this.graph.position.x,d)}this.context.strokeStyle=this.foreground,this.context.stroke()}}}class x{constructor(){this.mode=0,this.dom=document.createElement("div"),this.panels=[],this.background="#ffffff",this.initStyle(),this.dom.addEventListener("click",t=>{t.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},!1),this.beginTime=(performance||Date).now(),this.frames=0,this.panels.push(this.addPanel("FPS","#4080f0",100,(t,i)=>{const e={value:this.frames*1e3/i,maxValue:100};return this.frames=0,e})),this.panels.push(this.addPanel("MS","#33A033",0,t=>({value:t-this.beginTime,maxValue:200}))),performance&&performance.memory&&this.panels.push(this.addPanel("MB","#ff0088",100,()=>{if(!performance||!performance.memory)return;const t=performance.memory,i=1048576;return{value:t.usedJSHeapSize/i,maxValue:t.jsHeapSizeLimit/i}})),this.showPanel(0)}addPanel(t,i,e,s){const h=new m(t,i,this.background,e,s);return this.addPanelObject(h),h}showPanel(t){for(let i=0;i<this.dom.children.length;i++){const e=this.dom.children[i].style;e&&(e.display=i===t?"block":"none")}this.mode=t}begin(){this.beginTime=(performance||Date).now()}end(){const t=(performance||Date).now();this.frames++;for(const i of this.panels)i.update(t);return t}update(){this.beginTime=this.end()}addPanelObject(t){this.panels.push(t),this.dom.appendChild(t.dom)}initStyle(){const t=typeof matchMedia<"u"?matchMedia("(prefers-color-scheme: dark)"):void 0,i=()=>{this.updateStyle()};t!=null&&t.addEventListener?t==null||t.addEventListener("change",i):t!=null&&t.addListener&&(t==null||t.addListener(i)),this.updateStyle()}updateStyle(){var t;const i=typeof matchMedia<"u"?matchMedia("(prefers-color-scheme: dark)"):void 0,e=(t=i==null?void 0:i.matches)!==null&&t!==void 0?t:!1;this.dom.style.position="fixed",this.dom.style.top="5px",this.dom.style.left="5px",this.dom.style.cursor="pointer",this.dom.style.opacity="0.9",this.dom.style.zIndex="10000",this.dom.style.borderRadius="5px",e?(this.background="#000000",this.dom.style.boxShadow="-4px -4px 10px 0 rgb(255, 255, 255, 0.7)"):(this.background="#ffffff",this.dom.style.boxShadow="-4px -4px 10px 0 rgb(0, 0, 0, 0.7)");for(const s of this.panels)s.background=this.background}}export{x as S};
